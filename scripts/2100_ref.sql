INSERT INTO ref VALUES (2,150872916,1); 
INSERT INTO ref VALUES (2,141120810,5000); 
INSERT INTO ref VALUES (2,130331247,10000); 
INSERT INTO ref VALUES (2,118736610,15000); 
INSERT INTO ref VALUES (2,108071340,20000); 
INSERT INTO ref VALUES (2,98087511,25000); 
INSERT INTO ref VALUES (2,89262963,30000); 
INSERT INTO ref VALUES (2,74053954,40000); 
INSERT INTO ref VALUES (2,62138355,50000); 
INSERT INTO ref VALUES (2,41179909,75000); 
INSERT INTO ref VALUES (2,27671556,100000); 
INSERT INTO ref VALUES (2,7720106,200000); 
INSERT INTO ref VALUES (2,1505060,500000); 
INSERT INTO ref VALUES (2,494857,1000000); 
INSERT INTO ref VALUES (2,272246,1500000); 
INSERT INTO ref VALUES (2,181719,2000000); 
INSERT INTO ref VALUES (2,51851,5000000); 
INSERT INTO ref VALUES (2,20223,10000000);

DELETE FROM ref WHERE population_id<>2;

INSERT INTO ref
SELECT DISTINCT p.population_id,er.n,FIRST_VALUE(er.m) OVER w AS m
FROM ext_ref er INNER JOIN population p ON er.country_id=p.country_id AND er.country_id<>'US'
	WINDOW w AS (PARTITION BY p.population_id,er.n ORDER BY
				year DESC,
				CASE WHEN er.datasource='IRS.gov' THEN 0 ELSE CASE WHEN er.datasource='wid.world' THEN 1 ELSE 10 END END,
				CASE WHEN er.variable_type='tptinc992j' THEN 0 ELSE
                CASE WHEN er.variable_type='tptinc992i' THEN 1 ELSE
                CASE WHEN er.variable_type='tptinc992t' THEN 2 ELSE 10 END END END);